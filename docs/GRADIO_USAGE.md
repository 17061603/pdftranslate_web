# BabelDOC Gradio客户端使用说明

## 概述

BabelDOC Gradio客户端提供了一个直观的Web界面，用于与BabelDOC API服务器进行交互，实现PDF文档的在线翻译。

## 功能特性

### 🎯 核心功能
- **PDF文件上传**: 支持拖拽或点击上传PDF文件
- **实时预览**: 左侧显示原始PDF预览，右侧显示翻译结果预览
- **在线翻译**: 调用API服务器进行文档翻译
- **进度监控**: 实时显示翻译进度和状态
- **结果下载**: 翻译完成后可直接下载结果文件

### 📋 界面布局
- **左侧面板**: 
  - 文件上传区域
  - 原始PDF预览（显示前5页）
  - 翻译选项设置
  - 翻译按钮
- **右侧面板**:
  - 翻译状态显示
  - 翻译结果PDF预览
  - 下载按钮
- **底部区域**:
  - 任务状态查询功能

## 启动方式

### 前提条件
确保API服务器已启动：
```bash
# 启动API服务器
uv run python babeldoc/run_server.py
```

### 启动Gradio客户端
```bash
# 方法1：使用启动脚本
uv run python babeldoc/run_gradio.py

# 方法2：直接运行模块
uv run python -m babeldoc.gradio_client

# 方法3：自定义参数
uv run python babeldoc/run_gradio.py \
    --server-url http://localhost:8000 \
    --host 0.0.0.0 \
    --port 7860 \
    --share
```

### 命令行参数
- `--server-url`: API服务器地址 (默认: http://localhost:8000)
- `--host`: Gradio服务器主机 (默认: 0.0.0.0)
- `--port`: Gradio服务器端口 (默认: 7860)
- `--share`: 创建公共分享链接

## 使用流程

### 1. 检查服务器状态
启动后界面顶部会显示API服务器的连接状态和配置信息：
- ✅ 服务器在线：显示模型、默认语言等配置
- ❌ 服务器离线：显示连接错误信息

### 2. 上传PDF文件
- 点击"选择PDF文件"区域或拖拽PDF文件
- 上传后左侧会显示PDF预览（前5页）
- 支持的文件格式：.pdf

### 3. 设置翻译选项
- **源语言**: 留空使用服务器默认配置，或输入语言代码（如：en）
- **目标语言**: 留空使用服务器默认配置，或输入语言代码（如：zh）
- **输出类型**: 
  - `dual`: 双语对照版本
  - `mono`: 纯翻译版本

### 4. 开始翻译
- 点击"🚀 开始翻译"按钮
- 界面会显示实时翻译进度
- 翻译过程包括：提交任务 → 处理中 → 完成下载

### 5. 查看结果
- 翻译完成后右侧显示结果PDF预览
- 点击"下载翻译结果"按钮下载完整文件
- 可以查看任务ID和状态信息

### 6. 任务状态查询
在底部"任务状态查询"区域：
- 输入任务ID可查询任务状态
- 显示进度、消息和结果文件信息

## 界面截图说明

```
┌─────────────────────────────────────────────────────────────┐
│                BabelDOC PDF翻译工具                          │
│  ✅ 服务器在线 - 模型: deepseek-ai/DeepSeek-V3             │
├─────────────────────┬───────────────────────────────────────┤
│    📁 文件上传       │         📊 翻译状态                   │
│  [选择PDF文件]      │    等待上传文件...                    │
│                     │                                       │
│   📄 原始PDF预览     │         📑 翻译结果预览                │
│  ┌─────────────────┐ │    ┌─────────────────────────────────┐ │
│  │     页面1       │ │    │       翻译结果页面               │ │
│  │     页面2       │ │    │      (翻译完成后显示)            │ │
│  │     ...         │ │    │                                 │ │
│  └─────────────────┘ │    └─────────────────────────────────┘ │
│                     │                                       │
│   ⚙️ 翻译选项        │         [下载翻译结果]                 │
│  源语言: [  ]       │                                       │
│  目标语言: [  ]     │    任务信息: task_12345678             │
│  输出类型: dual     │                                       │
│                     │                                       │
│  [🚀 开始翻译]       │                                       │
├─────────────────────┴───────────────────────────────────────┤
│         🔍 任务状态查询                                      │
│  任务ID: [          ]  [查询]                               │
│  查询结果显示区域                                            │
└─────────────────────────────────────────────────────────────┘
```

## 技术特性

### PDF预览功能
- 使用PyMuPDF将PDF页面转换为图片
- 显示前5页预览，避免加载时间过长
- 自动调整图片大小适配界面

### 实时进度监控
- 通过API客户端轮询任务状态
- 显示详细的处理阶段和进度百分比
- 支持任务超时处理（1小时）

### 文件管理
- 自动创建临时目录存储上传和下载的文件
- 智能文件命名避免冲突
- 支持多种文件类型的下载

## 常见问题

### 1. 界面显示"服务器离线"
- 确认API服务器已启动并运行在正确端口
- 检查`--server-url`参数是否正确
- 确认网络连接正常

### 2. PDF预览不显示
- 确认上传的是有效的PDF文件
- 检查PDF文件是否已损坏
- 尝试重新上传文件

### 3. 翻译任务失败
- 查看右侧状态区域的错误信息
- 确认API服务器的OpenAI配置正确
- 检查网络连接和API密钥

### 4. 下载失败
- 确认翻译任务已完成
- 检查浏览器的下载设置
- 尝试刷新页面重新下载

## 部署建议

### 开发环境
```bash
# 同时启动API服务器和Gradio客户端
# 终端1
uv run python babeldoc/run_server.py

# 终端2  
uv run python babeldoc/run_gradio.py
```

### 生产环境
```bash
# 使用Docker Compose部署
# docker-compose.yml 示例:
version: '3.8'
services:
  api-server:
    build: .
    command: python babeldoc/run_server.py
    ports:
      - "8000:8000"
    volumes:
      - ./.env:/app/.env
  
  gradio-client:
    build: .
    command: python babeldoc/run_gradio.py --server-url http://api-server:8000
    ports:
      - "7860:7860"
    depends_on:
      - api-server
```

## 性能优化

1. **预览优化**: 只显示前5页预览，减少加载时间
2. **异步处理**: 使用Gradio的Progress功能显示实时进度
3. **缓存机制**: 复用API客户端连接
4. **文件管理**: 智能清理临时文件

通过这个Gradio客户端，用户可以享受到直观、友好的PDF翻译体验！